<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BandTogether â€¢ Home</title>
  <meta name="color-scheme" content="light dark">
  <style>
    /* =====================
       BandTogether â€” Starter UI
       Palette: blue / white / purple
       Modern, clean, responsive
       ===================== */

    :root {
      --bg: #0f1221;               /* deep blue-purple */
      --bg-soft: #141836;
      --card: #101425;
      --elev: #0b0e1b;
      --text: #eaf0ff;
      --muted: #b8c2ff;
      --primary: #4f46e5;          /* indigo-600 */
      --primary-600: #4f46e5;
      --primary-500: #6366f1;
      --primary-400: #818cf8;
      --accent: #2ea3ff;           /* blue */
      --accent-400: #60c1ff;
      --purple-400: #a78bfa;
      --ring: rgba(129, 140, 248, .35);
      --success: #22c55e;
      --danger: #ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius-sm: 12px;
      --radius-lg: 22px;
      --maxw: 1100px;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f5f7ff;
        --bg-soft: #eef2ff;
        --card: #ffffff;
        --elev: #ffffff;
        --text: #0d1020;
        --muted: #51597e;
        --shadow: 0 10px 26px rgba(9, 13, 46, 0.08);
        --ring: rgba(99, 102, 241, .28);
      }
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(99, 102, 241, .20), transparent 60%),
        radial-gradient(900px 600px at 90% 110%, rgba(46, 163, 255, .20), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg) 100%);
      min-height: 100dvh;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    /* Header / Brand */
    header {
      max-width: var(--maxw);
      margin: 28px auto 10px;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .logo {
      display: inline-flex; align-items: center; gap: 12px;
      text-decoration: none; color: inherit;
    }

    .logo__mark {
      width: 40px; height: 40px; border-radius: 12px;
      background: conic-gradient(from 180deg, var(--primary-400), var(--accent), var(--purple-400), var(--primary-400));
      position: relative; box-shadow: var(--shadow);
    }

    .logo__mark::after {
      content: ""; position: absolute; inset: 5px; border-radius: 9px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 40%),
                  linear-gradient(180deg, rgba(255,255,255,.2), rgba(255,255,255,0));
    }

    .logo__type { font-weight: 800; letter-spacing: .2px; font-size: 1.25rem; }
    .logo__accent { background: linear-gradient(90deg, var(--accent), var(--primary-400)); -webkit-background-clip: text; background-clip: text; color: transparent; }

    /* Shell */
    .shell { max-width: var(--maxw); margin: 0 auto; padding: 12px 20px 60px; }

    /* Hero / Current User Card */
    .user-card {
      display: grid; grid-template-columns: 88px 1fr; gap: 18px;
      background: var(--card); border-radius: var(--radius-lg);
      padding: 20px; box-shadow: var(--shadow);
      border: 1px solid rgba(129,140,248,.25);
    }

    .avatar {
      width: 88px; height: 88px; border-radius: 20px; overflow: hidden; flex: none;
      background: var(--bg-soft); border: 1px solid rgba(129,140,248,.25);
    }
    .avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .user-meta { display: flex; flex-direction: column; justify-content: center; }
    .user-name { font-size: clamp(1.1rem, 1.5vw + .6rem, 1.6rem); font-weight: 800; margin: 0; }
    .user-sub { margin: 6px 0 0; color: var(--muted); font-weight: 500; }

    /* Section heading */
    .section-head {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      margin: 26px 0 12px;
    }
    .section-title { font-size: 1rem; letter-spacing: .3px; text-transform: uppercase; color: var(--muted); }

    /* Engagement list */
    .list { display: grid; gap: 12px; }

    .card {
      background: var(--card); border: 1px solid rgba(129,140,248,.2);
      border-radius: var(--radius);
      overflow: clip; position: relative;
      box-shadow: var(--shadow);
      transition: transform .15s ease, border-color .2s ease;
    }

    .card:hover { transform: translateY(-1px); border-color: rgba(129,140,248,.45); }

    .engagement {
      display: grid; grid-template-columns: 120px 1fr auto; align-items: center; gap: 16px;
      padding: 14px 16px; cursor: pointer;
    }

    .date-pill {
      justify-self: start;
      background: linear-gradient(135deg, rgba(99,102,241,.18), rgba(46,163,255,.14));
      border: 1px solid rgba(129,140,248,.35);
      border-radius: 14px; padding: 8px 12px; line-height: 1.1;
      display: grid; place-items: center; min-width: 110px;
    }
    .date-pill b { display: block; font-size: .95rem; }
    .date-pill span { display: block; font-size: .8rem; color: var(--muted); }

    .summary {
      min-width: 0; /* truncate */
    }
    .summary h3 {
      margin: 0 0 4px; font-size: 1rem; font-weight: 700; letter-spacing: .2px;
    }
    .summary p { margin: 0; color: var(--muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .people {
      display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;
      justify-self: end;
    }
    .stack {
      display: inline-grid; grid-auto-flow: column; gap: 0; padding-left: 6px; 
    }
    .chip {
      height: 34px; min-width: 34px; border-radius: 999px; border: 1px solid rgba(129,140,248,.35);
      display: inline-flex; align-items: center; gap: 8px; padding: 0 10px 0 3px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
      margin-left: -10px; box-shadow: 0 6px 14px rgba(0,0,0,.15);
    }
    .chip img { width: 28px; height: 28px; border-radius: 999px; border: 1px solid rgba(129,140,248,.55); }
    .chip span { display: none; font-size: .85rem; color: var(--text); }

    @media (min-width: 720px) { .chip span { display: inline; } }

    /* Expandable content */
    .expand {
      border-top: 1px solid rgba(129,140,248,.16);
      padding: 0 16px; max-height: 0; overflow: hidden;
      transition: max-height .35s ease;
      background: linear-gradient(180deg, rgba(99,102,241,.06), transparent 60%);
    }
    .expand-inner { padding: 14px 0 16px; display: grid; gap: 8px; }

    .meta-grid { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    .meta {
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0));
      border: 1px solid rgba(129,140,248,.25);
      border-radius: 10px; padding: 10px 12px; font-size: .92rem;
    }
    .meta b { display: block; font-size: .74rem; letter-spacing: .25px; text-transform: uppercase; color: var(--muted); margin-bottom: 6px; }

    .actions { display: flex; gap: 10px; justify-content: flex-end; padding: 0 16px 14px; }
    .btn {
      border: 1px solid rgba(129,140,248,.45); background: linear-gradient(180deg, var(--primary-500), var(--primary-600));
      color: white; padding: 10px 14px; border-radius: 12px; font-weight: 700; letter-spacing: .2px; cursor: pointer;
      box-shadow: 0 8px 18px rgba(99,102,241,.35); transition: transform .12s ease, filter .12s ease;
    }
    .btn:hover { transform: translateY(-1px); filter: brightness(1.03); }
    .btn.secondary {
      background: transparent; color: var(--primary-500);
      border: 1px solid rgba(99,102,241,.55); box-shadow: none;
    }

    /* Empty state */
    .empty {
      background: var(--card); border: 1px dashed rgba(129,140,248,.4);
      border-radius: var(--radius); padding: 22px; text-align: center; color: var(--muted);
    }

    /* Utilities */
    .sr-only { position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0; }

    /* Responsive */
    @media (max-width: 720px) {
      .engagement { grid-template-columns: 1fr; gap: 10px; }
      .date-pill { justify-self: stretch; text-align: center; min-width: 0; }
      .people { justify-self: start; }
      .user-card { grid-template-columns: 72px 1fr; }
      .avatar { width: 72px; height: 72px; border-radius: 16px; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; animation: none !important; }
    }
  </style>
</head>
<body>
  <header>
    <a class="logo" href="#" aria-label="BandTogether Home">
      <span class="logo__mark" aria-hidden="true"></span>
      <span class="logo__type">Band<span class="logo__accent">Together</span></span>
    </a>
  </header>

  <main class="shell">
    <!-- Current user card / profile summary -->
    <section class="user-card" aria-labelledby="you">
      <div class="avatar" id="user-avatar" aria-hidden="true">
        <img alt="" src="https://images.unsplash.com/photo-1502685104226-ee32379fefbe?w=256&q=80&auto=format&fit=crop" />
      </div>
      <div class="user-meta">
        <h1 id="you" class="user-name">Welcome, <span id="user-name">Jesse Cabell</span> ðŸ‘‹</h1>
        <p class="user-sub">Hereâ€™s whatâ€™s coming up for you.</p>
      </div>
    </section>

    <div class="section-head">
      <h2 class="section-title">Upcoming engagements</h2>
    </div>

    <!-- Engagement list rendered by JS -->
    <section id="engagement-list" class="list" aria-live="polite" aria-busy="true">
      <!-- Cards will be injected here -->
    </section>
  </main>

  <template id="engagement-card-template">
    <article class="card">
      <button class="engagement" aria-expanded="false" aria-controls="details-:id:" data-id=":id:" title="Show details">
        <div class="date-pill"><b>:datePretty:</b><span>:weekday:</span></div>
        <div class="summary">
          <h3>:title:</h3>
          <p>:summary:</p>
        </div>
        <div class="people">
          <div class="stack">:peopleChips:</div>
        </div>
      </button>
      <div id="details-:id:" class="expand" hidden>
        <div class="expand-inner">
          <div class="meta-grid">
            <div class="meta"><b>Title</b><span>:title:</span></div>
            <div class="meta"><b>Date</b><span>:dateFull:</span></div>
            <div class="meta"><b>Time</b><span>:timeRange:</span></div>
            <div class="meta"><b>Created</b><span>:createdAt:</span></div>
          </div>
          <div class="meta" style="grid-column: 1/-1">
            <b>Description</b>
            <div>:descriptionHTML:</div>
          </div>
          <div class="meta" style="grid-column: 1/-1">
            <b>Attendees</b>
            <div class="stack">:peopleChipsFull:</div>
          </div>
        </div>
        <div class="actions">
          <button class="btn secondary" data-action="edit">Edit</button>
          <button class="btn" data-action="open">Open</button>
        </div>
      </div>
    </article>
  </template>

  <script>
    // =====================
    // BandTogether â€¢ Home
    // Vanilla JS starter with a render() pipeline and accessible disclosure cards
    // =====================

    // --- Replace this with real data from your backend ---
    const currentUser = {
      id: "u_self",
      name: "Jesse Cabell",
      avatar: "https://images.unsplash.com/photo-1502685104226-ee32379fefbe?w=256&q=80&auto=format&fit=crop"
    };

    /** Example event shape you can mirror in your API
     *  id: string
     *  title: string
     *  description: string (markdown or plain)
     *  date: ISO date string (YYYY-MM-DD)
     *  start: ISO time (HH:MM)
     *  end: ISO time (HH:MM)
     *  users: [{ id, name, avatar }]
     *  createdAt: ISO datetime
     */
    const demoEvents = [
      {
        id: "evt_rockmill",
        title: "Full-band rehearsal @ Rockmill Studio",
        description: "Tighten the bridge on *Neon Skyline* and run the set twice. Bring in-ears.\n\n- Arrive 10 early for line check\n- Metronome at 106 bpm for **Skyline**\n- New harmony on chorus 2",
        date: new Date().toISOString().slice(0,10),
        start: "19:00",
        end: "21:30",
        users: [
          { id: "u1", name: "Ava", avatar: "https://i.pravatar.cc/64?img=32" },
          { id: "u2", name: "Miguel", avatar: "https://i.pravatar.cc/64?img=5" },
          { id: "u3", name: "Sam", avatar: "https://i.pravatar.cc/64?img=15" },
          currentUser,
        ],
        createdAt: new Date(Date.now() - 1000*60*60*24*3).toISOString()
      },
      {
        id: "evt_cafe",
        title: "Acoustic duo â€“ Blue Finch Cafe",
        description: "2Ã—45 sets. Bring DI, capo, merch square reader. House provides PA.",
        date: new Date(Date.now() + 1000*60*60*24*2).toISOString().slice(0,10),
        start: "18:30",
        end: "20:15",
        users: [
          { id: "u5", name: "Riley", avatar: "https://i.pravatar.cc/64?img=48" },
          currentUser,
        ],
        createdAt: new Date(Date.now() - 1000*60*60*24*10).toISOString()
      },
      {
        id: "evt_fest",
        title: "Riverlights Festival â€“ Main Stage",
        description: "30-min changeover. City backline available. Parking passes in drive.",
        date: new Date(Date.now() + 1000*60*60*24*12).toISOString().slice(0,10),
        start: "16:00",
        end: "17:00",
        users: [
          { id: "u6", name: "Taylor", avatar: "https://i.pravatar.cc/64?img=21" },
          { id: "u7", name: "Jordan", avatar: "https://i.pravatar.cc/64?img=11" },
          currentUser,
        ],
        createdAt: new Date(Date.now() - 1000*60*60*24*20).toISOString()
      }
    ];

    // ---- Formatting helpers ----
    const fmt = new Intl.DateTimeFormat(undefined, { year: 'numeric', month: 'short', day: '2-digit' });
    const fmtLong = new Intl.DateTimeFormat(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    const fmtWeekday = new Intl.DateTimeFormat(undefined, { weekday: 'short' });

    const timeFmt = (hhmm) => {
      const [h, m] = hhmm.split(':').map(Number);
      const d = new Date(); d.setHours(h, m, 0, 0);
      return new Intl.DateTimeFormat(undefined, { hour: 'numeric', minute: '2-digit' }).format(d);
    };

    const mdToHTML = (s="") => {
      // ultra-light MD: *italic*, **bold**, - bullets
      return s
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/(^|\n)-\s+(.*)/g, '$1â€¢ $2')
        .replace(/\n\n/g, '<br/><br/>')
        .replace(/\n/g, '<br/>');
    };

    // ---- Render pipeline ----
    function renderUser(u) {
      document.getElementById('user-name').textContent = u.name;
      const img = document.querySelector('#user-avatar img');
      img.src = u.avatar;
      img.alt = `${u.name}'s profile picture`;
    }

    function chipHTML(p) {
      const name = p.name ?? 'Unknown';
      const avatar = p.avatar ?? 'https://i.pravatar.cc/64?u=unknown';
      return `<span class="chip" title="${name}"><img alt="" src="${avatar}" loading="lazy"/><span>${name}</span></span>`;
    }

    function engagementCardHTML(e) {
      const dateObj = new Date(e.date + 'T00:00:00');
      const datePretty = fmt.format(dateObj);
      const weekday = fmtWeekday.format(dateObj);
      const dateFull = fmtLong.format(dateObj);
      const timeRange = `${timeFmt(e.start)} â€“ ${timeFmt(e.end)}`;
      const createdAt = new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeStyle: 'short' }).format(new Date(e.createdAt));
      const summary = e.description.split(/\n|\./)[0].slice(0, 140);
      const peopleChips = e.users.slice(0,4).map(chipHTML).join('');
      const peopleChipsFull = e.users.map(chipHTML).join('');

      const tpl = document.getElementById('engagement-card-template').innerHTML
        .replaceAll(':id:', e.id)
        .replaceAll(':datePretty:', datePretty)
        .replaceAll(':weekday:', weekday)
        .replaceAll(':title:', escapeHtml(e.title))
        .replaceAll(':summary:', escapeHtml(summary))
        .replaceAll(':dateFull:', dateFull)
        .replaceAll(':timeRange:', timeRange)
        .replaceAll(':createdAt:', createdAt)
        .replaceAll(':descriptionHTML:', mdToHTML(escapeHtml(e.description)))
        .replaceAll(':peopleChips:', peopleChips)
        .replaceAll(':peopleChipsFull:', peopleChipsFull);

      const wrap = document.createElement('div');
      wrap.innerHTML = tpl.trim();
      const card = wrap.firstElementChild;

      // Disclosure behavior
      const btn = card.querySelector('.engagement');
      const panel = card.querySelector('.expand');
      btn.addEventListener('click', () => togglePanel(btn, panel));
      btn.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); btn.click(); }
      });

      // Card actions (stub)
      card.querySelector('[data-action="open"]').addEventListener('click', (ev) => {
        ev.stopPropagation();
        console.log('Open engagement', e.id);
        // window.location.href = `/engagements/${encodeURIComponent(e.id)}`;
      });
      card.querySelector('[data-action="edit"]').addEventListener('click', (ev) => {
        ev.stopPropagation();
        console.log('Edit engagement', e.id);
      });

      return card;
    }

    function togglePanel(button, panel) {
      const expanded = button.getAttribute('aria-expanded') === 'true';
      const next = !expanded;
      button.setAttribute('aria-expanded', String(next));
      panel.hidden = false;
      // Animate height
      panel.style.maxHeight = next ? panel.scrollHeight + 'px' : '0px';
      // Collapse after transition to allow tab focus handling
      if (!next) {
        panel.addEventListener('transitionend', function onEnd() {
          panel.hidden = true; panel.removeEventListener('transitionend', onEnd);
        });
      }
    }

    function renderList(events) {
      const list = document.getElementById('engagement-list');
      list.innerHTML = '';

      if (!events?.length) {
        list.innerHTML = `<div class="empty">No upcoming engagements yet. Once you add a rehearsal or gig, you'll see it here.</div>`;
        list.setAttribute('aria-busy', 'false');
        return;
      }

      const frag = document.createDocumentFragment();
      events
        .slice()
        .sort((a,b) => (a.date + ' ' + a.start).localeCompare(b.date + ' ' + b.start))
        .forEach(e => frag.appendChild(engagementCardHTML(e)));
      list.appendChild(frag);
      list.setAttribute('aria-busy', 'false');
    }

    function escapeHtml(str="") {
      return str
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }

    // ---- Data boot ----
    async function boot() {
      renderUser(currentUser);
      // TODO: replace demoEvents with real data. Example:
      // const res = await fetch('/api/engagements');
      // const events = await res.json();
      const events = demoEvents;
      renderList(events);
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
